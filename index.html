<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impostor del Under - Premium Beta</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/k51D1wYF/4x-(1).avif">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        :root { --glow-color: #ff0000; }
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #050505; color: #e0e0e0; padding: 20px; margin: 0; overflow-x: hidden; height: 100vh; display: flex; flex-direction: column; align-items: center; }
        
        /* --- FONDO --- */
        .bg-element { position: fixed; top: 50%; left: 50%; width: 400px; height: 400px; z-index: -1; transform: translate(-50%, -50%); opacity: 0.25; filter: drop-shadow(0 0 10px var(--glow-color)); pointer-events: none; object-fit: contain; }
        
        /* --- AJUSTES PREMIUM --- */
        .settings-btn { position: fixed; top: 25px; right: 25px; background: rgba(15, 15, 15, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); color: white; padding: 10px; border-radius: 50%; cursor: pointer; z-index: 100; font-size: 22px; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); transition: 0.4s; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .settings-btn:hover { transform: rotate(90deg) scale(1.1); border-color: var(--glow-color); box-shadow: 0 0 20px var(--glow-color); }
        #settings-panel { position: fixed; top: 85px; right: 25px; width: 220px; background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 0, 0, 0.3); padding: 20px; border-radius: 20px; z-index: 101; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
        .preset-btn { font-size: 11px; padding: 12px; width: 100%; margin-bottom: 8px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); color: #bbb; border-radius: 12px; cursor: pointer; transition: 0.3s; font-weight: bold; text-transform: uppercase; }
        .preset-btn:hover { background: rgba(255, 0, 0, 0.1); border-color: var(--glow-color); color: white; }

        /* --- BOT√ìN COPIAR --- */
        .copy-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; padding: 6px 12px; border-radius: 10px; font-size: 10px; font-family: 'Orbitron'; cursor: pointer; margin-left: 10px; transition: 0.3s; }
        .copy-success { background: #28a745 !important; border-color: white !important; box-shadow: 0 0 15px rgba(40, 167, 69, 0.5); }

        /* --- UI GENERAL --- */
        .card { background: rgba(20, 20, 20, 0.75); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 25px; padding: 30px; max-width: 450px; width: 90%; margin: 20px auto; box-shadow: 0 15px 35px rgba(0,0,0,0.7); }
        h1 { font-family: 'Orbitron', sans-serif; font-size: 2.2rem; color: #ffffff; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 15px var(--glow-color); }
        button { background: rgba(26, 26, 26, 0.8); border: 2px solid var(--glow-color); color: white; padding: 14px 28px; margin: 10px; border-radius: 12px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; box-shadow: 0 4px 0px #800000; width: 85%; }
        button:hover { background: var(--glow-color); transform: translateY(-2px); box-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 6px 0px #800000; }
        
        /* BOT√ìN ONLINE ROJO */
        .btn-online { border-color: #8b0000; box-shadow: 0 4px 0px #4a0000; }
        .btn-online:hover { background: #b30000; border-color: #ff0000; box-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 6px 0px #4a0000; }

        input, select { padding: 12px; margin: 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); width: 85%; background: rgba(30, 30, 30, 0.8); color: white; text-align: center; }
        .hidden { display: none; }
        .artist-img { width: 250px; height: 250px; object-fit: cover; border-radius: 20px; border: 4px solid var(--glow-color); margin-top: 15px; }
        .impostor-text { color: var(--glow-color); font-size: 28px; font-weight: 900; font-family: 'Orbitron'; margin-top: 15px; text-shadow: 0 0 15px rgba(255, 0, 0, 0.6); }
        .player-tag { margin: 5px; display: inline-block; background: rgba(255, 255, 255, 0.1); padding: 5px 15px; border-radius: 20px; color: #ffffff; font-weight: bold; border: 1px solid rgba(255,255,255,0.2); }
        .artist-name-display { font-family: 'Orbitron'; color: #ffffff; font-size: 24px; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
    </style>
</head>
<body>

    <div class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</div>
    <div id="settings-panel" class="hidden">
        <h3 style="font-family:'Orbitron'; font-size:0.7rem; color:#fff;">AJUSTES VISUALES</h3>
        <div class="preset-grid">
            <button class="preset-btn" onclick="changeBg('https://i.gifer.com/origin/9f/9f6c9a72c4143f9e7cbc6e4b6253a4e7.gif')">üåø MARIHUANA</button>
            <button class="preset-btn" onclick="changeBg('https://i.gifer.com/origin/c3/c3eac7a9248cfb7b27e6803199dc906f.gif')">ü•§ DOUBLE CUP</button>
            <button class="preset-btn" onclick="changeBg('https://i.postimg.cc/qM53PzCM/3dgifmaker86249.gif')">‚≠ê MATECAPP</button>
            <button class="preset-btn" onclick="changeBg('https://i.postimg.cc/ZqT4jLYs/3dgifmaker97841.gif')">üèÜ GOLDGE</button> 
        </div>
    </div>

    <img id="main-bg" src="https://i.gifer.com/origin/9f/9f6c9a72c4143f9e7cbc6e4b6253a4e7.gif" class="bg-element">

    <div id="menu-inicio" class="card">
        <h1>IMPOSTOR DEL UNDER</h1>
        <p style="color:#888;">by FORTINEROCAVS</p>
        <button onclick="playClick(); navegar('local-setup')">MODO LOCAL</button>
        <button class="btn-online" onclick="playClick(); navegar('online-setup')">MODO ONLINE</button>
    </div>

    <div id="local-setup" class="card hidden">
        <h1>MODO LOCAL</h1>
        <p>Jugadores (separados por coma):</p>
        <input type="text" id="playerNames" placeholder="Escribe los nombres">
        <p>Impostores:</p>
        <input type="number" id="impostorCount" value="1" min="1">
        <select id="local-category">
            <option value="nacional">UNDER ARGENTINO üá¶üá∑</option>
            <option value="internacional">UNDER INTERNACIONAL üåé</option>
        </select>
        <button onclick="playClick(); startGameLocal()">EMPEZAR</button>
        <br><button onclick="playClick(); navegar('menu-inicio')" style="background:rgba(50,50,50,0.5); border:none; width:auto; font-size:12px;">VOLVER</button>
    </div>

    <div id="local-game" class="card hidden">
        <h2 style="font-family:'Orbitron'; font-size:1.1rem;">TURNO DE:</h2>
        <div id="playerButtonsLocal"></div>
        <br>
        <button onclick="playClick(); startGameLocal()" style="background:rgba(255,255,255,0.05); width:auto; font-size:11px;">REPETIR (NUEVO ARTISTA)</button>
        <button onclick="playClick(); navegar('menu-inicio')" style="background:rgba(50,50,50,0.5); width:auto; font-size:11px;">MEN√ö PRINCIPAL</button>
    </div>

    <div id="online-setup" class="card hidden">
        <h1>MODO ONLINE</h1>
        <input type="text" id="playerNameOnline" placeholder="TU APODO">
        <button onclick="playClick(); hostear()">HOSTEAR PARTIDA</button>
        <div style="margin: 10px; color:#444;">‚Äî O ‚Äî</div>
        <input type="text" id="roomCode" placeholder="C√ìDIGO DE SALA">
        <button onclick="playClick(); unirse()">UNIRSE A SALA</button>
        <br><button onclick="playClick(); navegar('menu-inicio')" style="background:rgba(50,50,50,0.5); border:none; width:auto;">VOLVER</button>
    </div>

    <div id="lobby" class="card hidden">
        <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
            <h1 id="display-codigo" style="margin: 0; font-size: 1.5rem;">SALA: ----</h1>
            <button class="copy-btn" onclick="copiarCodigo()">üìã COPIAR</button>
        </div>
        <div id="lista-jugadores" style="margin-bottom: 20px;"></div>
        <div id="opciones-host" class="hidden">
            <select id="online-category">
                <option value="nacional">UNDER ARGENTINO üá¶üá∑</option>
                <option value="internacional">UNDER INTERNACIONAL üåé</option>
            </select>
            <button onclick="playClick(); comenzarJuegoOnline()">EMPEZAR JUEGO</button>
            <br>
            <button style="background:rgba(255,0,0,0.2); border-color:#ff0000; font-size:10px; width:auto; margin-top: 10px;" onclick="playClick(); cerrarSala()">ELIMINAR SALA (HOST)</button>
        </div>
        <p id="msg-espera">Esperando al host...</p>
        <button onclick="playClick(); salirDeSala()" style="background:transparent; border:1px solid rgba(255,0,0,0.4); color:rgba(255,255,255,0.5); font-size:10px; width:auto; margin-top:20px; box-shadow:none;">
            ‚Üê ABANDONAR SALA
        </button>
    </div>

    <div id="reveal" class="card hidden">
        <h2 id="currentPlayerDisplay" style="font-family: 'Orbitron'; color: #ff0000;"></h2>
        <div id="secretWord"></div>
        <br>
        <button id="btn-listo-local" class="hidden" onclick="playClick(); volverAlGridLocal()">YA LO VI (OCULTAR)</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, child, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCwvdaZOLQYFPrAj00z9C00fi9L6h3RqQ",
            authDomain: "impostor-under.firebaseapp.com",
            databaseURL: "https://impostor-under-default-rtdb.firebaseio.com",
            projectId: "impostor-under",
            storageBucket: "impostor-under.firebasestorage.app",
            messagingSenderId: "817403614820",
            appId: "1:817403614820:web:27186b698a818fbd56b171"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.navegar = (id) => {
            const pantallas = ['menu-inicio', 'local-setup', 'local-game', 'online-setup', 'lobby', 'reveal'];
            pantallas.forEach(p => document.getElementById(p).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        };

        window.toggleSettings = () => { document.getElementById('settings-panel').classList.toggle('hidden'); };
        window.changeBg = (url) => { document.getElementById('main-bg').src = url; playClick(); };
        const clickSound = new Audio("https://www.soundjay.com/buttons/sounds/button-16.mp3");
        window.playClick = () => { clickSound.currentTime = 0; clickSound.play().catch(()=>{}); };

        window.copiarCodigo = () => {
            const texto = document.getElementById('display-codigo').innerText.replace("SALA: ", "");
            navigator.clipboard.writeText(texto).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.innerText = "‚úÖ COPIADO";
                btn.classList.add('copy-success');
                setTimeout(() => { btn.innerText = "üìã COPIAR"; btn.classList.remove('copy-success'); }, 2000);
            });
            playClick();
        };

        const data = {
            nacional: [
                { name: "enzocerobulto", img: "https://i.postimg.cc/Gt8gDdX3/Captura-de-pantalla-2025-12-24-222000.png" },
                { name: "cero*", img: "https://images.genius.com/89341d9a7fd370ea3d9c4fdd9da534c1.955x955x1.jpg" },
                { name: "LoLo", img: "https://images.genius.com/3326aa6a0dafae6a4d5b537c58024724.1000x1000x1.jpg" },
                { name: "Frozouda", img: "https://i.postimg.cc/L4Lbm6g3/FRO-2-DISPONIBLE-EN-TODO-EL-MUNDO-lasreconciliaciones-EXISTEN.jpg" },
                { name: "Zell", img: "https://images.genius.com/b882b7173c3dd73eb59c69a5d6bb3195.767x767x1.jpg" },
                { name: "Bic", img: "https://i.scdn.co/image/ab6761610000e5ebb54a9d616d9623597caf569d" },
                { name: "Choosey", img: "https://i.postimg.cc/HWzbwfqM/nou-kap.webp" },
                { name: "Stiffy", img: "https://i.scdn.co/image/ab67616100005174ca976dc555059fa8321e672f" },
                { name: "AgusFortnite2008", img: "https://images.genius.com/14d07d12fa5c59b66c18ccd78d4dc4ed.1000x1000x1.png" },
                { name: "Joshu Joshu", img: "https://akamai.sscdn.co/uploadfile/letras/fotos/e/4/8/9/e489a3d08fad665e2ec3cf8e49e4a94c.jpg" },
                { name: "ISMALDZ", img: "https://i.postimg.cc/wTJyWZPF/nuevo-video-en-breveeeeee-2037.jpg" },
                { name: "huntr", img: "https://i.postimg.cc/rs96s8sQ/Captura-de-pantalla-2025-12-24-223945.png" },
                { name: "Little Boogie", img: "https://i.postimg.cc/0QdXdVsV/Seran-angeles-o-demonios-todas-estas-voces.jpg" },
                { name: "Magnesio", img: "https://i.postimg.cc/YCGXyr7z/Captura-de-pantalla-2025-12-24-224313.png" },
                { name: "Pabloxo", img: "https://images.genius.com/cd02d950f7ec4221a876531847d9cd7d.1000x1000x1.jpg" },
                { name: "TooYugan", img: "https://i.scdn.co/image/ab6761610000e5eb74a776c6799a7e3a541aadff" },
                { name: "Saramalacara", img: "https://i1.sndcdn.com/avatars-c8xXcz8MF86Xly9U-LecIyw-t1080x1080.jpg" },
                { name: "SixUp", img: "https://i.scdn.co/image/ab6761610000e5ebbf877a11d26f93d179cc6a18" },
                { name: "Turrobaby", img: "https://streetartlatam.s3.us-east-1.amazonaws.com/production/Turrobaby_pilar_de_la_nueva_escena_del_genero_urbano_argentino_192c29249f.jpg" },
                { name: "Shako", img: "https://i.postimg.cc/L6rk5zdg/anhelostudios-anhelostudios-ge.jpg" },
                { name: "Cl√∫ster", img: "https://images.genius.com/7edaae77b7f3aa31b932954ba50e6fce.542x542x1.png" },
                { name: "Polus", img: "https://i.postimg.cc/G2HJ9zpV/get.jpg" },
                { name: "Vahel", img: "https://i.postimg.cc/XN5dhrBB/533418608-17881435881364809-3823578737294317030-n.jpg" },
                { name: "Blagh", img: "https://cdn-images.dzcdn.net/images/cover/750d3fd0259fbf8846a2d862040d8477/1900x1900-000000-80-0-0.jpg" },
                { name: "Jugo", img: "https://i.scdn.co/image/ab6761610000e5eb1d2d1249588f2711a9063a39" },
                { name: "143leti", img: "https://images.genius.com/0ded9119574cba694ed1755c030e482b.1000x1000x1.png" },
                { name: "salasflaco", img: "https://i.postimg.cc/Kzgzjp6b/channels4-profile.jpg" },
                { name: "Hellolola", img: "https://i.postimg.cc/vB9Ybgnn/channels4-profile-(1).jpg" },
                { name: "panchitolefleur", img: "https://i1.sndcdn.com/avatars-HcU1cc6L0enEflCQ-53xxDw-t1080x1080.jpg" },
                { name: "Nykoo0", img: "https://i.postimg.cc/VLLstTwf/574186866-18096188749801792-4009584160816206924-n.jpg" },
                { name: "Hepa", img: "https://i.postimg.cc/sXrsgHmq/541597304-18477601273076861-1456195632179985994-n.jpg" },
                { name: "2UU!", img: "https://i.postimg.cc/qv6TXH5p/Se-va-un-2025-lleno-de-emociones-lleno-de-cosas-increibles-conoci-muchas-provincias-de-argenti.jpg" }
            ],
            internacional: [
                { name: "Cybernene", img: "https://i.scdn.co/image/ab6761610000e5eb89de19647487810a7a70b873" },
                { name: "Bbtrickz", img: "https://highxtar.com/wp-content/uploads/2023/11/highxtar-bb-trickz-1-1440x1080.jpg" },
                { name: "Playboi Carti", img: "https://cdn-images.dzcdn.net/images/artist/b90097972a60d9d8598a79a786be1a3a/1900x1900-000000-81-0-0.jpg" },
                { name: "Che", img: "https://vmagazine.com/wp-content/uploads/2025/07/IMG_5552.jpeg" },
                { name: "Chief Keef", img: "https://d2umolmz9zcmr8.cloudfront.net/unsafe/2560x0/filters:no_upscale():quality(60)/contentmedia%2Fff98540f-7643-42e8-b16e-7a3a8678fa03.jpg" },
                { name: "Kanye West", img: "https://upload.wikimedia.org/wikipedia/commons/5/5c/Kanye_West_at_the_2009_Tribeca_Film_Festival_%28crop_2%29.jpg" },
                { name: "2hollis", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/2Hollis.jpg/250px-2Hollis.jpg" },
                { name: "Nettspend", img: "https://i.scdn.co/image/ab676161000051746bc255a221b2d2db4c1de21f" },
                { name: "Rojuu", img: "https://i.scdn.co/image/ab6761610000e5eb0d5f7931593af45b92981acc" },
                { name: "Osamason", img: "https://osamasonmerch.com/wp-content/uploads/2024/03/Osamason-Merch-2.jpg" },
                { name: "PACHUDANIüèÑ‚Äç‚ôÇÔ∏è", img: "https://i.postimg.cc/gkSFQ5HF/descarga-(1).jpg" },
                { name: "Wiz Khalifa", img: "https://i.scdn.co/image/ab6761610000e5ebc66b0a8c3268f0b6556f64a8" },
                { name: "Sa!koro", img: "https://images.genius.com/c2e1b9704d362f2826af42e98a878d96.500x500x1.png" },
                { name: "Underaiki", img: "https://i.postimg.cc/8PjM29fD/Whats-App-Image-2025-12-25-at-22-07-27.jpg" },
                { name: "Laurasad", img: "https://i.postimg.cc/htdkQbX7/q-loko-q-ta-mi-vasitoooooooooo.jpg" },
                { name: "Francis Jeremy", img: "https://i.scdn.co/image/ab67616d00001e02765fe3d4cdb634f95b9aab19" },
                { name: "HWII", img: "https://i.postimg.cc/4xrQnq0q/image.jpg" },
                { name: "xaviersobased", img: "https://i.postimg.cc/pLC9wP1L/1900x1900-000000-80-0-0.jpg" }
            ]
        };

        let rolesLocal = [];
        let usadosLocal = { nacional: [], internacional: [] };

        window.startGameLocal = () => {
            const names = document.getElementById('playerNames').value.split(',').map(n=>n.trim()).filter(n=>n!=="");
            const num = parseInt(document.getElementById('impostorCount').value);
            const cat = document.getElementById('local-category').value;
            if(names.length <= num) return alert("Faltan jugadores");

            let disponibles = data[cat].filter(a => !usadosLocal[cat].includes(a.name));
            if (disponibles.length === 0) { usadosLocal[cat] = []; disponibles = data[cat]; }

            const art = disponibles[Math.floor(Math.random()*disponibles.length)];
            usadosLocal[cat].push(art.name);

            rolesLocal = names.map(n => ({ playerName: n, artistName: art.name, img: art.img, isImpostor: false, seen: false }));
            let count = 0; while(count < num) { 
                let i = Math.floor(Math.random()*rolesLocal.length); 
                if(!rolesLocal[i].isImpostor) { rolesLocal[i].isImpostor = true; count++; } 
            }
            renderButtonsLocal();
            navegar('local-game');
        };

        function renderButtonsLocal() {
            const container = document.getElementById('playerButtonsLocal');
            container.innerHTML = rolesLocal.map((p, i) => p.seen ? '' : `<button onclick="playClick(); showSecretLocal(${i})">${p.playerName}</button>`).join("");
            if (rolesLocal.every(p => p.seen)) container.innerHTML = "<p style='color:red; font-family:Orbitron;'>¬°TODOS LISTOS!</p>";
        }

        window.showSecretLocal = (i) => {
            const p = rolesLocal[i]; p.seen = true;
            document.getElementById('currentPlayerDisplay').innerText = p.playerName;
            const wordEl = document.getElementById('secretWord');
            if (p.isImpostor) {
                wordEl.innerHTML = `<img src="https://cdn.betterttv.net/emote/5ccc411b152e896edf4acbd4/3x.gif" style="width:250px; border-radius:15px; border: 3px solid #ff0000;"><div class="impostor-text">ERES EL IMPOSTOR</div>`;
            } else {
                wordEl.innerHTML = `<p style="color:#aaa;">Tu Artista:</p><img src="${p.img}" class="artist-img"><br><span class="artist-name-display">${p.artistName}</span>`;
            }
            navegar('reveal');
            document.getElementById('btn-listo-local').classList.remove('hidden');
        }

        window.volverAlGridLocal = () => { navegar('local-game'); renderButtonsLocal(); };

        window.hostear = async () => {
            const nombre = document.getElementById('playerNameOnline').value;
            if(!nombre) return alert("Escribe tu apodo");
            const codigo = Math.random().toString(36).substring(2, 6).toUpperCase();
            await set(ref(db, 'salas/' + codigo), { jugadores: { [nombre]: true } });
            iniciarLobby(codigo, nombre, true);
        };

        window.unirse = async () => {
            const nombre = document.getElementById('playerNameOnline').value;
            const code = document.getElementById('roomCode').value.toUpperCase();
            if(!nombre || !code) return alert("Faltan datos");
            const snap = await get(child(ref(db), `salas/${code}`));
            if (snap.exists()) {
                const sala = snap.val();
                if (Object.keys(sala.jugadores || {}).length >= 10) return alert("Sala llena");
                await set(ref(db, `salas/${code}/jugadores/${nombre}`), true);
                iniciarLobby(code, nombre, false);
            } else alert("No existe la sala");
        };

        function iniciarLobby(codigo, miNombre, esHost) {
            navegar('lobby');
            document.getElementById('display-codigo').innerText = "SALA: " + codigo;
            if(esHost) document.getElementById('opciones-host').classList.remove('hidden');

            onValue(ref(db, `salas/${codigo}`), (snap) => {
                if(!snap.exists()) return navegar('menu-inicio');
                const sala = snap.val();
                if(sala.jugadores) {
                    document.getElementById('lista-jugadores').innerHTML = Object.keys(sala.jugadores).map(n => `<span class="player-tag">üë§ ${n}</span>`).join("");
                }
                if (sala.juego && sala.juego.activa) {
                    const j = sala.juego;
                    navegar('reveal');
                    document.getElementById('currentPlayerDisplay').innerText = miNombre;
                    const wordEl = document.getElementById('secretWord');
                    if (j.impostor === miNombre) {
                        wordEl.innerHTML = `<img src="https://cdn.betterttv.net/emote/5ccc411b152e896edf4acbd4/3x.gif" style="width:250px; border-radius:15px; border: 3px solid #ff0000;"><div class="impostor-text">SOS EL IMPOSTOR</div>`;
                    } else {
                        wordEl.innerHTML = `<p style="color:#aaa;">Tu artista:</p><img src="${j.img}" class="artist-img"><br><span class="artist-name-display">${j.artistName}</span>`;
                    }
                    if(esHost && !document.getElementById('btn-next')) {
                        wordEl.innerHTML += `<br><button id="btn-next" onclick="playClick(); reiniciarPartidaOnline()" style="margin-top:20px; width:auto; background:rgba(255,255,255,0.1); border-color:#fff;">NUEVA RONDA</button>`;
                    }
                } else {
                    navegar('lobby');
                }
            });
        }

        window.comenzarJuegoOnline = async () => {
            const codigo = document.getElementById('display-codigo').innerText.replace("SALA: ", "");
            const snapshot = await get(child(ref(db), `salas/${codigo}`));
            const sala = snapshot.val();
            const players = Object.keys(sala.jugadores);
            const cat = document.getElementById('online-category').value;
            let usados = sala.usados || [];
            let disponibles = data[cat].filter(a => !usados.includes(a.name));
            if (disponibles.length === 0) { usados = []; disponibles = data[cat]; }

            let artista = disponibles[Math.floor(Math.random()*disponibles.length)];
            const impo = players[Math.floor(Math.random()*players.length)];
            await set(ref(db, `salas/${codigo}/juego`), { impostor: impo, artistName: artista.name, img: artista.img, activa: true });
            await set(ref(db, `salas/${codigo}/usados`), [...usados, artista.name]);
        };

        window.reiniciarPartidaOnline = async () => { const codigo = document.getElementById('display-codigo').innerText.replace("SALA: ", ""); await remove(ref(db, `salas/${codigo}/juego`)); };
        window.cerrarSala = async () => { if(confirm("¬øEliminar sala definitivamente?")) { const codigo = document.getElementById('display-codigo').innerText.replace("SALA: ", ""); await remove(ref(db, `salas/${codigo}`)); navegar('menu-inicio'); } };
        
        window.salirDeSala = () => {
            if(confirm("¬øSeguro que quieres abandonar la sala?")) {
                navegar('menu-inicio');
            }
        };
    </script>
</body>
</html>
